<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Dawghaus</title>

    <link rel="stylesheet" href="dawghaus.css" />

    <script src="lib/jquery-1.8.2.min.js"></script>
    <script src="lib/jquery.console.js"></script>
    <script src="lib/roy.js"></script>
    <script src="lib/htmlrepl.js"></script>
    <script src="lib/royloader.js"></script>
    <script>
      window.turtle = {
        lt: function(degrees) { console.log("lt " + degrees)},
        rt: function(degrees) { console.log("rt " + degrees)},
        fd: function(distance) { console.log("fd " + distance)}
      }
    </script>
    <script type="text/roy" language="roy">
      let show x = (Object x).toString()
      let fd d = \() -> turtle.fd d
      let lt a = \() -> turtle.lt a
      let rt a = \() -> turtle.rt a

      let always x = (\() -> x)

      let jsarray xs = (Array.apply null xs)
      let length xs = (jsarray xs).length
      let empty xs = (length xs) == 0
      let concat xs ys = (jsarray xs).concat ys
      let cons x xs = concat [x] xs
      let head xs = xs@0
      let tail xs = (jsarray xs).slice 1

      // xs :: IO ()
      // TODO: generalize to monads if possible
      let sequence xs = \() ->
        if empty xs then
          []
        else
          let first = (head xs) ()
          let rest = (sequence (tail xs)) ()
          (cons first rest)

      let ioMonad = {
        return: \x -> always x
        bind: \action f -> 
                           (\() -> 
                             let value = action ()
                             let action2 = f value
                             action2 ()
                           )
      }

      let runIO action = action ()

      let putStrLn line = \() -> 
        console.log line

      let main = do ioMonad
        text <- (\() -> "hello")
        _ <- putStrLn text
        _ <- putStrLn 1
        putStrLn 2
    </script>

  </head>
  <body>
     <canvas></canvas>
     <div class="console"></div>
  </body>
</html>
