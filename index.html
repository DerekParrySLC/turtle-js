<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Dawghaus</title>

    <link rel="stylesheet" href="dawghaus.css" />

    <script src="lib/jquery-1.8.2.min.js"></script>
    <script src="lib/jquery.console.js"></script>
    <script src="lib/roy.js"></script>
    <script src="lib/htmlrepl.js"></script>
    <script src="lib/royloader.js"></script>
    <script src="turtle.js"></script>
    <script>
      $(function() {
        context = $("canvas").get(0).getContext('2d');
        turtle = Turtle(context, 450, 150)
      })
    </script>
    <script type="text/roy" language="roy">
      let show x = (Object x).toString()
      let fd d = \() -> turtle.fd d
      let lt a = \() -> turtle.lt a
      let rt a = \() -> turtle.rt a
      let pendown = \() -> turtle.pendown ()
      let penup = \() -> turtle.penup ()

      let always x = (\() -> x)

      let jsarray xs = (Array.apply null xs)
      let length xs = (jsarray xs).length
      let empty xs = (length xs) == 0
      let concat xs ys = (jsarray xs).concat ys
      let cons x xs = concat [x] xs
      let head xs = xs@0
      let tail xs = (jsarray xs).slice 1

      // xs :: IO ()
      // TODO: generalize to monads if possible
      let sequence xs = \() ->
        if empty xs then
          []
        else
          let first = (head xs) ()
          let rest = (sequence (tail xs)) ()
          (cons first rest)

      let ioMonad = {
        return: \x -> always x
        bind: \action f -> 
                           (\() -> 
                             let value = action ()
                             let action2 = f value
                             action2 ()
                           )
      }

      let runIO action = action ()

      let putStrLn line = \() -> 
        console.log line

      let main = do ioMonad
        text <- (\() -> "hello")
        _ <- putStrLn text
        _ <- putStrLn 1
        putStrLn 2
    </script>

  </head>
  <body>
     <canvas width="900" height="300"></canvas>
     <div class="console"></div>
  </body>
</html>
